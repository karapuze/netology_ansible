# Домашнее задание к занятию 3 «Использование Ansible» - Натетков Александр

## Основная часть

1. Допишите playbook: нужно сделать ещё один play, который устанавливает и настраивает LightHouse.
2. При создании tasks рекомендую использовать модули: get_url, template, yum, apt.
3. Tasks должны: скачать статику LightHouse, установить Nginx или любой другой веб-сервер, настроить его конфиг для открытия LightHouse, запустить веб-сервер.
4. Подготовьте свой inventory-файл prod.yml.
5. Запустите ansible-lint site.yml и исправьте ошибки, если они есть.
6. Попробуйте запустить playbook на этом окружении с флагом --check.
7. Запустите playbook на prod.yml окружении с флагом --diff. Убедитесь, что изменения на системе произведены.
8. Повторно запустите playbook с флагом --diff и убедитесь, что playbook идемпотентен.
9. Подготовьте README.md-файл по своему playbook. В нём должно быть описано: что делает playbook, какие у него есть параметры и теги.
10. Готовый playbook выложите в свой репозиторий, поставьте тег 08-ansible-03-yandex на фиксирующий коммит, в ответ предоставьте ссылку на него.


## Ответы

### Описание playbook:

Этот Ansible playbook выполняет следующие действия:

1. **Установка Clickhouse (для хостов clickhouse):**
   - Обновление кэша apt.
   - Установка пакетов Clickhouse.
   - Создание базы данных `logs` в Clickhouse.

2. **Установка и настройка Vector (для хостов Vector):**
   - Загрузка архива с установочными файлами Vector.
   - Проверка наличия директории `/etc/vector` и её создание при необходимости.
   - Распаковка архива с Vector и его установка.
   - Создание systemd-службы для Vector.
   - Настройка конфигурационного файла Vector из шаблона.

3. **Установка и настройка LightHouse (для хостов lighthouse):**
   - Установка веб-сервера Nginx.
   - Загрузка статических файлов LightHouse с GitHub.
   - Проверка наличия директории `/var/www/html/lighthouse` и её создание при необходимости.
   - Распаковка архива с LightHouse в указанную директорию.
   - Настройка конфигурации Nginx для обслуживания LightHouse.
   - Активация конфигурации сайта LightHouse в Nginx.
   - Перезапуск сервиса Nginx для применения изменений.

### Параметры и теги:

- **Параметры:**
  - `clickhouse`: Хосты, на которых устанавливается Clickhouse.
  - `Vector`: Хосты, на которых устанавливается и настраивается Vector.
  - `lighthouse`: Хосты, на которых устанавливается и настраивается LightHouse.

- **Теги:**
  - `download`: Задачи, связанные с загрузкой архива Vector и LightHouse.
  - `unarchive`: Задачи, связанные с распаковкой архивов Vector и LightHouse.
  - `install`: Задачи, связанные с установкой исполняемых файлов Vector и веб-сервера Nginx.
  - `systemd`: Задачи, связанные с созданием systemd-службы для Vector.
  - `configure`: Задачи, связанные с настройкой конфигурационного файла Vector и Nginx для LightHouse.


### Пример использования:

```bash
ansible-playbook playbook.yml --tags "download, unarchive, install, configure, systemd, restart"
```